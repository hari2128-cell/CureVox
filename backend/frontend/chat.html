<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CureVox AI - Smart Consultation | Enterprise Medical AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        /* WORLD-CLASS ENTERPRISE - IDENTICAL UI */
        *{margin:0;padding:0;box-sizing:border-box}
        html { scroll-behavior: smooth; overflow-x: hidden; }
        body{
            font-family:'Inter',sans-serif;
            background:linear-gradient(135deg,#0f0f23 0%,#1a1a2e 50%,#16213e 100%);
            color:white;min-height:100vh;position:relative;overflow-x:hidden;line-height:1.6;
        }
        
        /* ENTERPRISE BACKGROUND */
        .bg-animation{
            position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;
            background: 
                radial-gradient(circle at 20% 80%,rgba(59,130,246,0.2) 0%,transparent 50%),
                radial-gradient(circle at 80% 20%,rgba(102,126,234,0.15) 0%,transparent 50%),
                radial-gradient(circle at 50% 50%,rgba(16,185,129,0.1) 0%,transparent 70%);
            animation:float 20s ease-in-out infinite;
        }
        @keyframes float{0%,100%{transform:translateY(0px) rotate(0deg)}33%{transform:translateY(-15px) rotate(0.5deg)}66%{transform:translateY(-10px) rotate(-0.5deg)}}

        /* ENTERPRISE SIDEBAR */
        .sidebar {
            position: fixed; left: 0; top: 0; height: 100vh; width: 280px;
            background: linear-gradient(180deg, #16213e 0%, #0f141f 100%);
            z-index: 1000; padding: 20px 0; border-right: 2px solid #334155;
            transition: all 0.3s ease;
        }
        .nav-logo { padding: 0 25px 30px; text-align: center; border-bottom: 1px solid #334155; margin-bottom: 30px; }
        .logo { font-size: 24px; font-weight: 700; color: #3b82f6; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .nav-menu { list-style: none; padding: 0 20px; }
        .nav-item { margin-bottom: 12px; }
        .nav-link { 
            display: flex; align-items: center; gap: 15px; padding: 18px 20px;
            color: #94a3b8; text-decoration: none; border-radius: 12px; font-weight: 500; font-size: 15px;
            transition: all 0.3s ease;
        }
        .nav-link:hover, .nav-link.active { 
            background: rgba(59, 130, 246, 0.25); color: #3b82f6; transform: translateX(8px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }
        .nav-link.active .nav-icon { color: #3b82f6; }
        .nav-icon { font-size: 20px; width: 24px; flex-shrink: 0; }

        .main-container { margin-left: 280px; min-height: 100vh; transition: all 0.3s ease; }
        .main { max-width: 1200px; margin: 0 auto; padding: 40px 30px 50px; position: relative; }

        /* ENTERPRISE HEADER */
        .header {
            background: rgba(22, 33, 62, 0.95); backdrop-filter: blur(30px);
            padding: 25px 35px; border-radius: 24px; margin-bottom: 40px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
        }
        .header-left { display: flex; align-items: center; gap: 25px; }
        .mobile-menu-btn { display: none; background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 10px; border-radius: 12px; }
        .page-title { font-size: 28px; font-weight: 700; color: #3b82f6; display: flex; align-items: center; gap: 12px; }
        .user-section { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
        .profile-container { display: flex; align-items: center; gap: 15px; cursor: pointer; padding: 12px 20px; background: rgba(255,255,255,0.08); border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; }
        .profile-container:hover { background: rgba(59,130,246,0.15); }
        .user-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 18px; }
        .user-info { text-align: right; min-width: 140px; }
        .user-name { font-weight: 600; margin-bottom: 4px; font-size: 16px; }
        .user-role { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .nav-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 12px 24px; border-radius: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .nav-btn:hover { background: rgba(59,130,246,0.2); transform: translateY(-2px); }
        .finish-btn { background: linear-gradient(135deg, #10b981, #059669); border: none; box-shadow: 0 10px 30px rgba(16,185,129,0.4); }
        .finish-btn:hover { box-shadow: 0 20px 40px rgba(16,185,129,0.5); }

        /* WORLD-CLASS SUMMARY CARD */
        .summary-card{
            background:rgba(255,255,255,0.08);backdrop-filter:blur(25px);border:1px solid rgba(255,255,255,0.15);
            border-radius:28px;padding:2.5rem;margin-bottom:2.5rem;display:flex;align-items:center;gap:2rem;
            box-shadow:0 25px 50px rgba(0,0,0,0.3);position:relative;overflow:hidden;
        }
        .summary-card::before{
            content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#3b82f6,#1d4ed8,transparent);
        }
        .summary-icon{width:90px;height:90px;border-radius:24px;display:flex;align-items:center;justify-content:center;
            font-size:2.2rem;box-shadow:0 10px 30px rgba(0,0,0,0.3);position:relative;z-index:1}
        .summary-content{flex:1}
        .summary-title{font-size:1.8rem;font-weight:700;margin-bottom:0.8rem;color:#3b82f6}
        .risk-badge{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:25px;font-weight:700;
            font-size:1rem;border:2px solid;margin-right:1rem}
        .risk-low{background:rgba(16,185,129,0.2);color:#10b981;border-color:#10b981}
        .risk-medium{background:rgba(245,158,11,0.2);color:#f59e0b;border-color:#f59e0b}
        .risk-high{background:rgba(239,68,68,0.2);color:#ef4444;border-color:#ef4444}
        .confidence-badge{background:rgba(102,126,234,0.2);color:#667eea;border:1px solid rgba(102,126,234,0.4);
            padding:6px 16px;border-radius:20px;font-size:0.95rem;font-weight:600;display:inline-flex;align-items:center;gap:4px}
        .summary-detail{color:rgba(255,255,255,0.8);font-size:1.1rem;margin-top:0.5rem}

        /* WORLD-CLASS CHAT */
        .chat-container{
            height:650px;background:rgba(255,255,255,0.06);backdrop-filter:blur(30px);border-radius:28px;
            border:1px solid rgba(255,255,255,0.15);padding:2.5rem;overflow-y:auto;margin-bottom:2.5rem;
            box-shadow:0 25px 50px rgba(0,0,0,0.3);position:relative;
        }
        .chat-container::-webkit-scrollbar{width:8px}
        .chat-container::-webkit-scrollbar-track{background:rgba(255,255,255,0.03)}
        .chat-container::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.15);border-radius:4px}

        .message{margin-bottom:2rem;display:flex;gap:1.5rem}
        .message.user{justify-content:flex-end}
        .message-content{
            max-width:75%;padding:1.8rem 2.2rem;border-radius:24px;position:relative;font-size:1.05rem;
            line-height:1.7;box-shadow:0 10px 30px rgba(0,0,0,0.2);backdrop-filter:blur(10px);
        }
        .message.user .message-content{
            background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:white;border-bottom-right-radius:12px;
        }
        .message.ai .message-content{
            background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);border-bottom-left-radius:12px;
        }
        .message-time{font-size:0.85rem;color:rgba(255,255,255,0.5);margin-top:0.8rem;display:flex;align-items:center;gap:4px}
        .message-icon{font-size:1.1rem}

        /* SMART TYPING */
        .typing-indicator{
            display:flex;align-items:center;gap:1rem;color:rgba(255,255,255,0.7);font-style:italic;
            padding:1.8rem 2.2rem;margin-bottom:2rem;background:rgba(255,255,255,0.08);border-radius:24px;
            border-bottom-left-radius:12px;border:1px solid rgba(255,255,255,0.15);backdrop-filter:blur(20px);
            animation:typing-fade 0.3s ease-in-out;
        }
        .typing-dots{display:flex;gap:4px}
        .typing-dots span{
            width:8px;height:8px;border-radius:50%;background:#3b82f6;animation:typing 1.4s infinite;
        }
        .typing-dots span:nth-child(2){animation-delay:0.2s}
        .typing-dots span:nth-child(3){animation-delay:0.4s}
        @keyframes typing{0%,60%,100%{transform:scale(1);opacity:0.5}30%{transform:scale(1.3);opacity:1}}
        @keyframes typing-fade{from{opacity:0;transform:translateY(10px)}}

        /* WORLD-CLASS INPUT */
        .input-area{
            display:flex;gap:1.5rem;align-items:flex-end;background:rgba(255,255,255,0.08);
            backdrop-filter:blur(25px);border-radius:32px;padding:1.5rem;border:1px solid rgba(255,255,255,0.15);
            box-shadow:0 20px 40px rgba(0,0,0,0.3);
        }
        .chat-input{
            flex:1;padding:1.5rem 2rem;border:2px solid transparent;border-radius:24px;
            background:rgba(255,255,255,0.12);color:white;font-size:1.05rem;font-family:inherit;
            outline:none;transition:all 0.3s;box-shadow:0 5px 20px rgba(0,0,0,0.2);
        }
        .chat-input:focus{
            border-color:rgba(59,130,246,0.5);box-shadow:0 0 0 4px rgba(59,130,246,0.15);
            background:rgba(255,255,255,0.18);
        }
        .chat-input::placeholder{color:rgba(255,255,255,0.5)}
        .voice-btn,.send-btn{
            width:64px;height:64px;border:none;border-radius:50%;cursor:pointer;display:flex;
            align-items:center;justify-content:center;font-size:1.4rem;transition:all 0.3s;
            box-shadow:0 10px 30px rgba(0,0,0,0.3);
        }
        .voice-btn{background:linear-gradient(135deg,#10b981,#059669);color:white}
        .voice-btn:hover{transform:scale(1.08);box-shadow:0 15px 40px rgba(16,185,129,0.5)}
        .voice-btn.listening{background:linear-gradient(135deg,#ef4444,#dc2626);animation:pulse 1.5s infinite}
        .send-btn{background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:white;margin-left:auto}
        .send-btn:hover{transform:scale(1.08);box-shadow:0 15px 40px rgba(59,130,246,0.5)}

        /* PERFECT RESPONSIVE */
        @media(max-width:1200px){.main-container{margin-left:260px}}
        @media(max-width:992px){
            .sidebar{width:240px;transform:translateX(-100%)}
            .sidebar.mobile-open{transform:translateX(0)}
            .main-container{margin-left:0}
            .mobile-menu-btn{display:block}
            .header{padding:20px 25px;flex-wrap:wrap;gap:15px}
            .user-section{justify-content:center;width:100%;margin-top:10px}
        }
        @media(max-width:768px){
            .main{padding:25px 20px 40px}
            .chat-container{height:550px;padding:2rem 1.5rem}
            .input-area{flex-direction:column;gap:1rem;padding:1.5rem}
            .voice-btn,.send-btn{width:56px;height:56px;font-size:1.2rem}
            .chat-input{padding:1.2rem 1.5rem}
            .summary-card{flex-direction:column;text-align:center;gap:1.5rem;padding:2rem}
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <!-- ENTERPRISE SIDEBAR -->
    <nav class="sidebar" id="sidebar">
        <div class="nav-logo">
            <div class="logo">
                <i class="fas fa-robot"></i> CureVox AI
            </div>
        </div>       
        <ul class="nav-menu">
            <li class="nav-item"><a href="/home.html" class="nav-link"><i class="fas fa-home nav-icon"></i><span>Home</span></a></li>
            <li class="nav-item"><a href="/reports.html" class="nav-link"><i class="fas fa-file-medical nav-icon"></i><span>Reports</span></a></li>
            <li class="nav-item"><a href="/dashboard.html" class="nav-link"><i class="fas fa-chart-line nav-icon"></i><span>Dashboard</span></a></li>
            <li class="nav-item"><a href="/about.html" class="nav-link"><i class="fas fa-info-circle nav-icon"></i><span>About</span></a></li>
        </ul>
    </nav>

    <div class="main-container" id="mainContainer">
        <!-- ENTERPRISE HEADER -->
        <header class="header">
            <div class="header-left">
                <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
                <div class="page-title">
                    <i class="fas fa-comments"></i> AI Consultation
                </div>
            </div>
            <div class="user-section">
                <div class="profile-container">
                    <div class="user-avatar">DS</div>
                    <div class="user-info">
                        <div class="user-name">Dr. Sarah Smith</div>
                        <div class="user-role">Senior Physician</div>
                    </div>
                </div>
                <button class="nav-btn" onclick="window.history.back()">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="nav-btn finish-btn" onclick="finishChat()">
                    <i class="fas fa-file-medical-alt"></i> Save Report
                </button>
            </div>
        </header>

        <main class="main">
            <!-- DYNAMIC ANALYSIS SUMMARY -->
            <div class="summary-card" id="summaryCard">
                <div class="summary-icon" id="summaryIcon">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <div class="summary-content">
                    <div class="summary-title" id="summaryTitle">Loading Analysis...</div>
                    <div id="riskSection">
                        <span class="risk-badge risk-low">
                            <i class="fas fa-shield-alt"></i> Loading...
                        </span>
                        <span class="confidence-badge">
                            <i class="fas fa-brain"></i> <span id="confidenceScore">Loading...</span>
                        </span>
                    </div>
                    <div class="summary-detail" id="summaryDetail">Please wait while we load your analysis...</div>
                </div>
            </div>

            <!-- WORLD-CLASS CHAT -->
            <div class="chat-container" id="chatContainer"></div>

            <!-- INPUT AREA -->
            <div class="input-area">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask about your results, symptoms, or treatment options... (⌘+Enter)">
                <button class="voice-btn" id="voiceBtn" title="Voice Input">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="send-btn" id="sendBtn" title="Send (⌘+Enter)">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </main>
    </div>

    <script>
        // WORLD-CLASS CHATBOT STATE
        class WorldClassChatbot {
            constructor() {
                this.recognition = null;
                this.isListening = false;
                this.analysisData = null;
                this.conversationHistory = [];
                this.elements = {};
                this.init();
            }

            init() {
                this.elements = {
                    chatContainer: document.getElementById('chatContainer'),
                    chatInput: document.getElementById('chatInput'),
                    voiceBtn: document.getElementById('voiceBtn'),
                    sendBtn: document.getElementById('sendBtn'),
                    summaryCard: document.getElementById('summaryCard')
                };

                this.initSpeech();
                this.loadAnalysis();
                this.bindEvents();
                this.welcomeMessage();
            }

            initSpeech() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';
                    
                    this.recognition.onresult = (event) => {
                        this.elements.chatInput.value = event.results[0][0].transcript;
                        this.sendMessage();
                    };
                    this.recognition.onerror = () => this.toggleVoice();
                }
            }

            async loadAnalysis() {
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const analysisId = urlParams.get('analysis');
                    
                    if (analysisId) {
                        this.analysisData = JSON.parse(sessionStorage.getItem('currentAnalysis'));
                        if (this.analysisData) {
                            this.renderAnalysisSummary();
                            this.conversationHistory.push({
                                role: 'system',
                                content: `Patient analysis: ${JSON.stringify(this.analysisData.result)}`
                            });
                        }
                    }
                } catch(e) {
                    console.error('Analysis load failed:', e);
                }
            }

            renderAnalysisSummary() {
                const data = this.analysisData;
                const iconMap = {
                    'audio': 'fa-microphone', 'rash': 'fa-image', 'separate_dual': 'fa-lungs'
                };
                const riskColors = { low: 'risk-low', medium: 'risk-medium', high: 'risk-high' };
                
                document.getElementById('summaryIcon').innerHTML = `<i class="fas ${iconMap[data.type] || 'fa-stethoscope'}"></i>`;
                document.getElementById('summaryTitle').textContent = 
                    `${data.type === 'audio' ? 'Audio' : data.type === 'rash' ? 'Rash' : 'Dual Audio'} Analysis Complete`;
                document.getElementById('riskSection').innerHTML = `
                    <span class="risk-badge ${riskColors[data.result.riskLevel || 'low']}">
                        <i class="fas fa-shield-alt"></i> ${data.result.riskLevel?.toUpperCase()} RISK
                    </span>
                    <span class="confidence-badge">
                        <i class="fas fa-brain"></i> ${Math.round((data.result.confidence || 0) * 100)}% Confidence
                    </span>
                `;
                document.getElementById('summaryDetail').textContent = data.result.insights || 'Analysis complete - ready for consultation';
            }

            bindEvents() {
                // Mobile sidebar
                document.getElementById('mobileMenuBtn').addEventListener('click', () => {
                    document.getElementById('sidebar').classList.toggle('mobile-open');
                });

                // Send message
                this.elements.sendBtn.addEventListener('click', () => this.sendMessage());
                this.elements.voiceBtn.addEventListener('click', () => this.toggleVoice());
                this.elements.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Auto-resize input
                this.elements.chatInput.addEventListener('input', (e) => {
                    e.target.style.height = 'auto';
                    e.target.style.height = e.target.scrollHeight + 'px';
                });
            }

            welcomeMessage() {
                const welcome = this.analysisData ? 
                    `Dr. AI: Hello Dr. Smith! I've analyzed your patient's ${this.analysisData.type} sample. ${this.analysisData.result.insights || 'Results look good!'} How can I assist with the diagnosis?` :
                    "Dr. AI: Welcome to CureVox AI Consultation! Upload an analysis or ask me about any medical condition.";
                
                this.addMessage(welcome, 'ai');
            }

            async sendMessage() {
                const message = this.elements.chatInput.value.trim();
                if (!message) return;

                this.addMessage(message, 'user');
                this.elements.chatInput.value = '';
                this.conversationHistory.push({ role: 'user', content: message });
                
                this.showTyping();
                this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;

                // WORLD-CLASS MEDICAL RESPONSES
                setTimeout(() => {
                    const response = this.generateMedicalResponse(message);
                    this.hideTyping();
                    this.addMessage(response, 'ai');
                    this.speakResponse(response);
                    this.conversationHistory.push({ role: 'assistant', content: response });
                }, 1200 + Math.random() * 800);
            }

            generateMedicalResponse(message) {
                const lowerMsg = message.toLowerCase();
                const analysis = this.analysisData?.result || {};
                
                // Context-aware medical responses
                if (lowerMsg.includes('cough') || lowerMsg.includes('breath')) {
                    return `Based on the audio analysis (${Math.round(analysis.confidence*100)}% confidence): ${analysis.conditions?.[0] || 'healthy patterns'} detected. Cough peak frequency: ${analysis.peakFrequency || 'normal'} Hz. Recommend monitoring if persistent.`;
                }
                if (lowerMsg.includes('rash') || lowerMsg.includes('skin')) {
                    return `Rash analysis shows ${analysis.condition || 'mild irritation'} (${analysis.rednessRatio ? Math.round(analysis.rednessRatio*100) + '%' : ''} affected). Grade ${analysis.severity || 1} severity. Topical treatment recommended.`;
                }
                if (lowerMsg.includes('explain') || lowerMsg.includes('results')) {
                    return `Your ${this.analysisData?.type} analysis: ${analysis.riskLevel?.toUpperCase()} risk (${Math.round(analysis.confidence*100)}% confidence). Key findings: ${analysis.insights || 'No major concerns'}.`;
                }
                
                // Smart medical responses
                const responses = {
                    asthma: "Asthma typically shows wheeze scores >0.3 and turbulent flow patterns. Your analysis shows normal respiratory dynamics.",
                    pneumonia: "Pneumonia indicators include crackles >200Hz and reduced lung volume. Your results are clear.",
                    treatment: "For mild cases: monitor symptoms, hydration, rest. Escalate if fever >100.4°F or persistent cough.",
                    next: "Next steps: Continue monitoring. Schedule follow-up if symptoms persist >7 days or worsen."
                };
                
                for (let [key, response] of Object.entries(responses)) {
                    if (lowerMsg.includes(key)) return response;
                }
                
                return "Excellent question! Your analysis shows healthy patterns. For ${analysis.conditions?.[0] || 'normal respiratory function'}, standard monitoring is sufficient. Any specific symptoms you're concerned about?";
            }

            addMessage(text, sender) {
                const div = document.createElement('div');
                div.className = `message ${sender}`;
                div.innerHTML = `
                    <div class="message-content">
                        <strong>${sender === 'user' ? 'You' : 'Dr. AI'}:</strong> ${text.replace(/\n/g, '<br>')}
                        <div class="message-time">
                            <i class="fas fa-clock message-icon"></i>
                            ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                        </div>
                    </div>
                `;
                this.elements.chatContainer.appendChild(div);
                this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
            }

            showTyping() {
                this.hideTyping();
                const div = document.createElement('div');
                div.className = 'typing-indicator';
                div.id = 'typingIndicator';
                div.innerHTML = `
                    <div>Dr. AI is analyzing your query</div>
                    <div class="typing-dots">
                        <span></span><span></span><span></span>
                    </div>
                `;
                this.elements.chatContainer.appendChild(div);
                this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
            }

            hideTyping() {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) indicator.remove();
            }

            toggleVoice() {
                if (!this.recognition) {
                    this.addMessage("Voice input not supported in this browser. Please type your question.", 'ai');
                    return;
                }
                
                if (!this.isListening) {
                    this.recognition.start();
                    this.isListening = true;
                    this.elements.voiceBtn.classList.add('listening');
                    this.elements.voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                    this.showTyping();
                } else {
                    this.recognition.stop();
                    this.isListening = false;
                    this.elements.voiceBtn.classList.remove('listening');
                    this.elements.voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                }
            }

            speakResponse(text) {
                if ('speechSynthesis' in window) {
                    const voices = speechSynthesis.getVoices();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.95;
                    utterance.pitch = 1.05;
                    utterance.volume = 0.8;
                    utterance.voice = voices.find(v => v.name.includes('Female') || v.name.includes('female')) || voices[0];
                    speechSynthesis.speak(utterance);
                }
            }
        }

        // Initialize WORLD-CLASS chatbot
        const chatbot = new WorldClassChatbot();

        // Global functions
        function finishChat() {
            const analysisId = new URLSearchParams(window.location.search).get('analysis');
            window.location.href = analysisId ? `/reports.html?analysis=${analysisId}` : '/reports.html';
        }
    </script>
</body>
</html>
